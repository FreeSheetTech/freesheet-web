<html>
     <head>
       <meta charset="UTF-8">
<link rel="stylesheet" href="http://localhost:63342/freesheet-web/css/handsontable.full.css"/>
<link rel="stylesheet" href="http://localhost:63342/freesheet-web/css/bootstrap.css"/>
<link rel="stylesheet" href="http://localhost:63342/freesheet-web/css/bootstrap-theme.css"/>
<link rel="stylesheet" href="http://localhost:63342/freesheet-web/css/freesheet-web.css"/>
<script src="http://localhost:63342/freesheet-web/js/lib/jquery.js"></script>
<script src="http://localhost:63342/freesheet-web/js/lib/bootstrap.js"></script>
<script src="http://localhost:63342/freesheet-web/js/lib/freesheet.js"></script>
<script src="http://localhost:63342/freesheet-web/js/freesheet-web.js"></script>

<title>Freesheet Active Page</title>
     </head>
     <body>
       <div class="freesheet-template">
                <div class="container">
<h2>League Table</h2>

<h3>New result&nbsp;</h3>
<label>Home team &nbsp; &nbsp;</label><input name="homeTeam" size="20" type="text" /> <label>Home goals &nbsp;&nbsp;</label><input maxlength="2" name="homeGoals" size="2" type="text" /> <label>Away team &nbsp;&nbsp;</label><input name="awayTeam" size="20" type="text" /> <label>Away goals &nbsp;</label><input maxlength="2" name="awayGoals" size="2" type="text" />
<p>&nbsp;<input name="enterResult" type="button" value="Enter" /></p>

<p>&nbsp;</p>

<h3>Current table</h3>
{{#eachInside League.leagueTable}}

<table border="1" cellpadding="1" cellspacing="1" class="table" style="width: 500px;">
	<thead>
		<tr>
			<th scope="col">Team</th>
			<th scope="col">Points</th>
		</tr>
	</thead>
	<tbody>
		<tr>
			<td>{{team}}</td>
			<td>{{points}}</td>
		</tr>
	</tbody>
</table>
{{/eachInside}}</div>

       </div>
       <script type="text/freesheet" data-name="Inputs">
   homeTeamInput = inputFrom("homeTeam");
homeGoalsInput = inputFrom("homeGoals");
awayTeamInput = inputFrom("awayTeam");
awayGoalsInput = inputFrom("awayGoals");
enterResult = click("enterResult");
result = { homeTeam: homeTeamInput,
  homeGoals: homeGoalsInput,
 awayTeam: awayTeamInput,
 awayGoals: awayGoalsInput};
resultInput = onChange(enterResult, result);

</script>
<script type="text/freesheet" data-name="League">
   incomingResults = fromSheet("Inputs", "resultInput");
results = collectOver(incomingResults);
awayTeams = fromEach(results, in.awayTeam);
homeTeams = fromEach(results, in.homeTeam);
teams = differentValues(homeTeams + awayTeams);
competitionResults = fromEach(teams, teamPoints(in));
leagueTable = sortBy(competitionResults, 0-in.points);
resultPoints(t, result) = {team: t,
points: pointsFromMatch(team, result) };
pointsFromMatch(team, result) = ifElse(winner(team, result), 3, ifElse(draw(result), 1, 0));
winner(team, result) = team == result.homeTeam and result.homeGoals > result.awayGoals
or team == result.awayTeam and result.awayGoals > result.homeGoals;
draw(result) = result.homeGoals == result.awayGoals;
teamResults(team) = select(results, isInvolved(in, team));
isInvolved(result, team) = team == result.homeTeam or team == result.awayTeam;
totalPoints(t) = sum(fromEach(teamResults(t), resultPoints(t, in).points));
teamPoints(t) = {team: t, points: totalPoints(t)};

</script>
       <script>
    require('freesheet-web').loadScriptsIntoWorksheets();
    require('reactive-template').convertTemplates();
</script>
     </body>
 </html>
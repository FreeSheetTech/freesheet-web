<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../../main/css/freesheet-web.css"/>
    <link rel="stylesheet" href="../../main/css/handsontable.full.css"/>

    <style>
        td.mark {
            width: 1em;
            padding: 3px;
        }
        td.mark.correct {
            background-color: #79f70f;
        }
        td.mark.incorrect {
            background-color: #fc6b75;
        }
    </style>
    <script src="../../main/js/lib/jquery.js"></script>
    <script src="../../main/js/lib/handsontable.full.js"></script>
    <script src="../../main/js/lib/freesheet.js"></script>


    <script src="js/meteor-skeleton.js"></script>
    <script src="js/underscore.js"></script>
    <script src="js/tracker.js"></script>
    <script src="js/htmljs.js"></script>
    <script src="js/html-tools.js"></script>
    <script src="js/reactive-var.js"></script>
    <script src="js/id-map.js"></script>
    <script src="js/base64.js"></script>
    <script src="js/ejson.js"></script>
    <script src="js/minimongo.js"></script>
    <script src="js/observe-sequence.js"></script>
    <script src="js/blaze.js"></script>
    <script src="js/blaze-tools.js"></script>
    <script src="js/templating.js"></script>
    <script src="js/spacebars-compiler.js"></script>
    <script src="js/spacebars.js"></script>
    <script src="js/reactive-dict.js"></script>

    <script src="../../main/js/web/FreesheetWeb.js"></script>
    <script src="../../main/js/web/PageFunctions.js"></script>
    <script src="../../main/js/worksheet/TableWorksheet.js"></script>
    <script src="../../main/js/template/ReactiveTemplate.js"></script>

    <title>Freesheet</title>
</head>
<body>
<h1>The Quiz</h1>

<div id="template" style="margin: 2em; display: none;">

    <p>Score: {{quiz.totalScore}}</p>
    <p>Time remaining: <progress max="{{quiz.timeAllowed}}" value = {{quiz.timeElapsed}}>{{quiz.timeLeft}}</progress></p>
    <p><button name="start">Start</button></p>
    <p>{{#if quiz.gameOver}}Game Over!{{/if}}</p>

    {{#if quiz.startTime}}
    <p>Questions</p>
    {{#eachInside quiz.questionsWithAnswers}}
    <table>
        <tr>
            <td>{{question}}</td>
            <td><input name="q{{id}}"></td>
            <td class="mark {{#if correct}}correct{{/if}} {{#if incorrect}}incorrect{{/if}}">{{#if correct}}Yes!{{/if}}{{#if incorrect}}No...{{/if}}</td>
        </tr>
    </table>
    {{/eachInside}}
    {{/if}}

</div>

<div id="rendered" class="content"></div>

<div id="quizWorksheet" class="freesheet-worksheets" style="margin-top:3em;"></div>

<script id="quiz" type="text/freesheet">
        questions = [
            {id: 1, question: "water", answer: "l'aqua"},
            {id: 2, question: "sea", answer: "il mare"},
            {id: 3, question: "boat", answer: "il barco"},
            {id: 4, question: "wave", answer: "l'onda"}
        ];

        questionsWithAnswers = fromEach(questions, {id: in.id, question: in.question, answer: in.answer,
                                                        entered: input("q"+in.id),
                                                        correct: entered and entered == in.answer,
                                                        incorrect: entered and entered <> in.answer,
                                                        score: ifElse(correct, 10, 0)
                                                        });
        answeredQuestions = select(questionsWithAnswers, in.entered);

        startTime = click("start");
        totalScore = sum(fromEach(questionsWithAnswers, in.score));
        timeAllowed = 30;
        timeElapsed = asSeconds(now - startTime);
        timeLeft = timeAllowed - timeElapsed;
        allAnswered = count(answeredQuestions) == count(questions);
        gameOver = or(timeLeft < 0, allAnswered);


</script>

<script>
    Freesheet.loadScripts();
    Freesheet.createWorksheets();
</script>

<script>
    var template = ReactiveTemplate.makeTemplate('#template');
    ReactiveTemplate.renderTemplate(template, '#rendered');
</script>
</body>
</html>
<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <link rel="stylesheet" href="../../main/css/freesheet-web.css"/>
    <link rel="stylesheet" href="../../main/css/handsontable.full.css"/>
    <script src="../../main/js/lib/jquery.js"></script>
    <script src="../../main/js/lib/handsontable.full.js"></script>
    <script src="../../main/js/lib/freesheet.js"></script>


    <script src="js/meteor-skeleton.js"></script>
    <script src="js/underscore.js"></script>
    <script src="js/tracker.js"></script>
    <script src="js/htmljs.js"></script>
    <script src="js/html-tools.js"></script>
    <script src="js/reactive-var.js"></script>
    <script src="js/id-map.js"></script>
    <script src="js/base64.js"></script>
    <script src="js/ejson.js"></script>
    <script src="js/minimongo.js"></script>
    <script src="js/observe-sequence.js"></script>
    <script src="js/blaze.js"></script>
    <script src="js/blaze-tools.js"></script>
    <script src="js/templating.js"></script>
    <script src="js/spacebars-compiler.js"></script>
    <script src="js/spacebars.js"></script>
    <script src="js/reactive-dict.js"></script>

    <script src="../../main/js/web/FreesheetWeb.js"></script>
    <script src="../../main/js/web/PageFunctions.js"></script>
    <script src="../../main/js/worksheet/TableWorksheet.js"></script>
    <script src="../../main/js/template/ReactiveTemplate.js"></script>

    <title>Freesheet</title>
</head>
<body>
<h1>The Quiz</h1>

<div id="template" class="content" style="margin: 2em;">

    <p>Questions</p>
    {{#eachInside quiz.questions}}
    <table>
        <tr><td>{{question}}</td>  <td><input name="q{{id}}"></td></tr>
    </table>
    {{/eachInside}}

    <button class="newMeaning">New Meaning</button>
    <button class="newQuestion">New Question</button>
</div>

<div id="rendered"></div>

<div id="quizWorksheet" class="freesheet-worksheets"></div>

<script id="quiz" type="text/freesheet">
        questions = [
            {id: 1, question: "water", answer: "l'aqua"},
            {id: 2, question: "sea", answer: "il mare"},
            {id: 3, question: "boat", answer: "il barco"},
            {id: 4, question: "wave", answer: "l'onda"}
        ];

        questionsWithAnswers = fromEach(questions, {id: in.id, question: in.question, answer: in.answer, entered: input("q"+in.id)});

        meaning = 142;

</script>

questionsWithAnswers = foreach(questions, merge(in, {entered: inputs("q" + in.id)}));


<script>
    Freesheet.loadScripts();
    Freesheet.createWorksheets();
</script>

<script>
    var template = ReactiveTemplate.makeTemplate('#template');
    ReactiveTemplate.renderTemplate(template, '#rendered');

    $('.newQuestion').on('click', function(){
        var quizSheet = Freesheet.sheets('quiz');
        var questions = quizSheet.formulaText('questions');
        var ans = Date.now() % 1000;
        newQuestion = "{question: \"q" + ans + "\", answer: " + "\"a" + ans + "\"" + "}";
        newQuestions = questions.replace(']', ", " + newQuestion + "]");
        quizSheet.update('questions', newQuestions);
    });
</script>
</body>
</html>